From 4d6cde5d1ee7074aeecb85b919ba63b33463ebd6 Mon Sep 17 00:00:00 2001
From: Eilo <eilo2518@gmail.com>
Date: Sun, 4 Mar 2012 09:20:18 -0500
Subject: [PATCH 45/70] =?UTF-8?q?2.2.41=20ICC:=20Saurfang=20a=C3=B1adido=20e?=
 =?UTF-8?q?l=20da=C3=B1o=20periodico=20de=20Marca=20del=20Campeon=20Caido?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 .../IcecrownCitadel/boss_deathbringer_saurfang.cpp |   20 ++++++++++++++++++++
 1 files changed, 20 insertions(+), 0 deletions(-)

diff --git a/src/server/scripts/Northrend/IcecrownCitadel/boss_deathbringer_saurfang.cpp b/src/server/scripts/Northrend/IcecrownCitadel/boss_deathbringer_saurfang.cpp
index a1e45a2..eb7c0c4 100755
--- a/src/server/scripts/Northrend/IcecrownCitadel/boss_deathbringer_saurfang.cpp
+++ b/src/server/scripts/Northrend/IcecrownCitadel/boss_deathbringer_saurfang.cpp
@@ -101,6 +101,7 @@ enum Spells
     SPELL_BLOOD_LINK_POWER              = 72195,
     SPELL_BLOOD_LINK_DUMMY              = 72202,
     SPELL_MARK_OF_THE_FALLEN_CHAMPION   = 72293,
+    SPELL_EFFECT_MARK_DMG               = 69189,
     SPELL_BOILING_BLOOD                 = 72385,
     SPELL_RUNE_OF_BLOOD                 = 72410,
 
@@ -407,6 +408,25 @@ class boss_deathbringer_saurfang : public CreatureScript
                 if (me->HasUnitState(UNIT_STATE_CASTING))
                     return;
 
+                // Daño periodico de la Marca del Campeon Caido a los players
+                if(me->isAttackReady())
+                {
+                    uint32 Markdmg;
+                    Markdmg =  urand(5700,6300);
+                    int Markdamage = Markdmg;
+
+                    Map::PlayerList const &pList = me->GetMap()->GetPlayers();
+
+                    if (pList.isEmpty())
+                        return;
+
+                    for (Map::PlayerList::const_iterator i = pList.begin(); i != pList.end(); ++i)
+                        if (Player* player = i->getSource())
+                            if (player->isAlive())
+                                if (player->HasAura(SPELL_MARK_OF_THE_FALLEN_CHAMPION))
+                                    me->CastCustomSpell(player, SPELL_EFFECT_MARK_DMG,&Markdamage, 0, 0, true);
+                }
+
                 while (uint32 eventId = events.ExecuteEvent())
                 {
                     switch (eventId)
-- 
1.7.8.msysgit.0

