From fffeafc40838db2974edb3eeb9fb08005d9c47ec Mon Sep 17 00:00:00 2001
From: Hispano <jesus.diaz.gutierrez@gmail.com>
Date: Sun, 4 Mar 2012 17:38:02 +0100
Subject: [PATCH 32/34] =?UTF-8?q?1.32=20Spline=20Subsystem:=20fix=20un=20cra?=
 =?UTF-8?q?sh=20cuando=20un=20jugador=20se=20desconecta=20en=20un=20=C3=A1re?=
 =?UTF-8?q?a=20hostil.=20El=20spell=20de=20honorless=20deber=C3=ADa=20y=20ya?=
 =?UTF-8?q?=20esta=20casteado=20despu=C3=A9s=20de=20haber=20recibido=20CMSG=5F?=
 =?UTF-8?q?MOVE=5FSPLINE=5FDONE.?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 .../WaypointMovementGenerator.cpp                  |    9 +++------
 1 files changed, 3 insertions(+), 6 deletions(-)

diff --git a/src/server/game/Movement/MovementGenerators/WaypointMovementGenerator.cpp b/src/server/game/Movement/MovementGenerators/WaypointMovementGenerator.cpp
index 55cf3c2..da84325 100755
--- a/src/server/game/Movement/MovementGenerators/WaypointMovementGenerator.cpp
+++ b/src/server/game/Movement/MovementGenerators/WaypointMovementGenerator.cpp
@@ -201,20 +201,17 @@ void FlightPathMovementGenerator::Initialize(Player &player)
     InitEndGridInfo();
 }
 
-void FlightPathMovementGenerator::Finalize(Player & player)
+void FlightPathMovementGenerator::Finalize(Player& player)
 {
     // remove flag to prevent send object build movement packets for flight state and crash (movement generator already not at top of stack)
     player.ClearUnitState(UNIT_STATE_IN_FLIGHT);
 
     player.Dismount();
-    player.RemoveFlag(UNIT_FIELD_FLAGS,UNIT_FLAG_DISABLE_MOVE | UNIT_FLAG_TAXI_FLIGHT);
+    player.RemoveFlag(UNIT_FIELD_FLAGS, UNIT_FLAG_DISABLE_MOVE | UNIT_FLAG_TAXI_FLIGHT);
 
-    if(player.m_taxi.empty())
+    if (player.m_taxi.empty())
     {
         player.getHostileRefManager().setOnlineOfflineState(true);
-        if(player.pvpInfo.inHostileArea)
-            player.CastSpell(&player, 2479, true);
-
         // update z position to ground and orientation for landing point
         // this prevent cheating with landing  point at lags
         // when client side flight end early in comparison server side
-- 
1.7.8.msysgit.0

